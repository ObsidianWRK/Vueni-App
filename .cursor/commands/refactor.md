Refactor the provided code for clarity and maintainability.

Focus areas (I'll identify which apply):
- Extract functions/methods for reuse
- Reduce cyclomatic complexity
- Improve variable/function naming
- Remove code duplication (DRY)
- Add/improve type annotations
- Split large files into modules

Constraints:
- Preserve behavior exactly
- One major refactor per response
- Explain the improvement and tradeoffs
- Show before/after diff when helpful

Output format:

## Analysis
What issues I found and why they matter.

## Refactored Code
```language
// The improved code
```

## Changes Made
- Bullet list of specific improvements
- Why each change helps

## Tradeoffs
Any considerations or alternatives (if applicable).

---

Code to refactor:
(paste code here)
